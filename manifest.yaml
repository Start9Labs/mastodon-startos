id: mastodon
title: Mastodon
version: 3.4.1
release-notes: "Upgrade to Mastodon 3.4.1 and EmbassyOS v0.3.0"
license: mit
wrapper-repo: "https://github.com/Start9Labs/mastodon-wrapper"
upstream-repo: "https://github.com/Start9Labs/mastodon/tree/cli-edits"
support-site: "https://discourse.joinmastodon.org/"
marketing-site: "https://joinmastodon.org/"
donation-url: "https://patreon.com/mastodon"
build: ["make"]
min-os-version: "0.3.0"
description:
  short: A free, open-source social network server
  long: |
    Mastodon is a free, open-source social network server based on ActivityPub where users can follow friends and discover new ones. On Mastodon, users can publish anything they want: links, pictures, text, video. All Mastodon servers are interoperable as a federated network (users on one server can seamlessly communicate with users from another one, including non-Mastodon software that implements ActivityPub)!
assets:
  license: LICENSE
  icon: icon.png
  instructions: instructions.md
  docker-images: image.tar
main:
  type: docker
  image: main
  entrypoint: docker_entrypoint.sh
  args: []
  mounts:
    main: /root/persistence
    compat: /mnt/assets
  io-format: yaml
health-checks:
  federation:
    name: Federation
    description: Activates once your Mastodon server is federating properly with other Mastodon servers. Indicates that Mastodon is ready for use.
    type: docker
    image: utils
    system: true
    entrypoint: curl
    args:
      - http://mastodon.embassy:3000
    mounts: {}
    io-format: yaml
    severity: warning
config:
  get:
    type: docker
    image: compat
    system: true
    entrypoint: compat
    args: 
      - config
      - get
      - /root/persistence
      - /mnt/assets/config_spec.yaml
    mounts:
      main: /root/persistence
      compat: /mnt/assets
    io-format: yaml
  set:
    type: docker
    image: compat
    system: true
    entrypoint: compat
    args:
      - config
      - set
      - mastodon
      - /root/persistence
      - /mnt/assets/config_rules.yaml
    mounts:
      main: /root/persistence
      compat: /mnt/assets
    io-format: yaml
properties:
  type: docker
  image: compat
  system: true
  entrypoint: compat
  args:
    - properties
    - /root/persistence
  mounts:
    main: /root/persistence
  io-format: yaml
volumes:
  main:
    type: data
  compat:
    type: assets
alerts:
  install: |
    After starting mastodon for the first time, it can take a long time (several minutes) to be ready.
    Please be patient. On future starts of the service, it will be faster, but still takes longer than other services.
    Make sure to sign up for a user before giving out your link. The first user to sign up is set as the admin user.
  start: |
    It may take several minutes after startup for this service to be ready for use.
interfaces:
  main:
    name: Main Interface
    description: Hosts the Mastodon web app and the federation API
    tor-config:
      port-mapping:
        80: "80"
        3000: "3000"
        4000: "4000"
    ui: true
    protocols:
      - tcp
      - http
      - activitypub
dependencies: {}
backup:
  create:
    type: docker
    image: compat
    system: true
    entrypoint: compat
    args:
      - duplicity
      - create
      - /mnt/backup
      - /root/persistence
    mounts:
      BACKUP: /mnt/backup
      main: /root/persistence
    io-format: yaml
  restore:
    type: docker
    image: compat
    system: true
    entrypoint: compat
    args:
      - duplicity
      - restore
      - /mnt/backup
      - /root/persistence
    mounts:
      BACKUP: /mnt/backup
      main: /root/persistence
    io-format: yaml
actions:
  reset-first-user:
    name: Reset First User
    description: This action will make your earliest registered user account an admin, and reset its password to a random value.
    allowed-statuses:
      - running
    implementation:
      type: docker
      image: main
      system: false
      entrypoint: docker_entrypoint.sh
      args: ["reset_first_user.sh"]
      io-format: json
      inject: true
